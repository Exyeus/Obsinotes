好的，同学们！欢迎来到 EECS 70 的图论世界！今天我们要探索一种强大的抽象工具，它能帮助我们理解和分析各种复杂的网络结构。从古老的桥梁问题，到现代的互联网、社交网络，再到我们大脑中的神经元连接，图论无处不在。准备好一起揭开图论的神秘面纱了吗？

### 图论：抽象的力量

我们 EECS 领域的一个核心思想就是**抽象 (abstraction)**。我们通过建立简单的模型来抓住复杂事物的本质。在计算机科学和工程中，我们经常需要处理各种各样的“网络”：万维网页面之间的链接、电路中元器件的连接、社交网络中人与人之间的关系，甚至生物系统中的交互（比如基因调控网络、大脑神经连接）。图论（Graph Theory）正是描述和分析这些网络结构的有力工具。

想象一下，如果你想研究社交媒体上信息是如何传播的，你不需要关心每个用户具体是谁、住在哪里、长什么样，你只需要知道谁“关注”了谁，或者谁和谁是“朋友”。这种关系结构，正是图论的核心研究对象。

图论的历史可以追溯到几个世纪前普鲁士哥尼斯堡（Königsberg）居民的一个消遣：如何才能一次不重复地走过城里的七座桥，并最终回到起点？请看 Note 中图 1(a) 的哥尼斯堡地图。通过城市的普雷格尔河将城市分成了两块陆地 A 和 D，以及两个岛屿 B 和 C，共有七座桥连接它们。居民们尝试寻找一条路径，可以恰好穿过每座桥一次并回到出发点。

伟大的数学家欧拉 (Leonhard Euler) 在 1736 年解决了这个问题。他的关键一步就是进行了**抽象**！他将每块陆地（A, B, C, D）抽象成一个点，将每座桥抽象成连接这些点的线。这样，复杂的地理问题就变成了一个纯粹的数学问题（见图 1(b)）。问题变成了：能否在这个抽象的图形中，沿着线一次不重复地走完所有线，并回到起点？欧拉证明了这是不可能的。他是怎么做到的呢？直观地说，如果一条路径能走过每条线一次并回到起点，那么每当你走到一个点（不是起点或终点），你必须从某条线进来，再从另一条线出去。这样，进出的线的数量必须相等。如果在起点/终点，你从那里出发一次，最后必须回到那里一次。所以，除了起点/终点，每个点连接的线的数量必须是偶数。如果起点和终点是同一个点（形成一个闭合路径），那么起点/终点的进出次数也必须配对，因此它连接的线的数量也必须是偶数。所以，如果存在这样一条路径，每个点的连接线数量必须是偶数。但在欧拉抽象出的图形中，所有点连接的线数量都是奇数！所以这样的路径是不存在的。

欧拉不仅证明了不可能，他还给出了存在这种路径的精确条件。这通常被认为是图论的开端。

### 形式化定义

现在，让我们用更严谨的数学语言来定义图。

一个**无向图 (undirected graph)** $$G = (V, E)$$ 由一个**顶点集 (vertices)** $V$ 和一个**边集 (edges)** $E$ 组成。每条边是 $V$ 中两个顶点组成的**无序对** $\{u, v\}$。我们可以用点表示顶点，用连接点的线段（或曲线）表示边。例如，Note 中图 2 的 $G_2$ 就是一个无向图，顶点集 $V = \{1, 2, 3, 4, 5\}$，边集 $E = \{\{1, 2\}, \{2, 3\}, \{3, 4\}, \{4, 5\}, \{5, 1\}\}$。

Note 中图 1(b) 的哥尼斯堡图是一个稍微更一般的例子，它允许在同一对顶点之间有多条边，这种叫做**多重图 (multigraph)**。通常情况下，我们讨论的无向图不包含多重边。

如果边的方向很重要，我们就使用**有向图 (directed graph)**。一个有向图 $$G = (V, E)$$ 也是由顶点集 $V$ 和边集 $E$ 组成，但边现在是顶点的**有序对** $(u, v)$。这意味着 $(u, v)$ 这条边和 $(v, u)$ 这条边是不同的。有向图中的边通常表示为从 $u$ 指向 $v$ 的**箭头 (arrow)**。Note 中图 2 的 $G_1$ 是一个有向图，顶点集 $V = \{1, 2, 3, 4\}$，边集 $E = \{(1, 2), (1, 3), (1, 4)\}$。例如，$(1, 2)$ 是一条边，但 $(2, 1)$ 不是。

我们可以把无向图看作一种特殊的有向图，其中每条无向边 $\{u, v\}$ 都对应着两条有向边 $(u, v)$ 和 $(v, u)$。就像双向街道可以看作是方向相反的两条单向街道。

无向图和有向图可以建模不同类型的关系：
*   无向图：建模对称关系。例如，社交网络中的“朋友”关系（如果 A 是 B 的朋友，那么 B 也是 A 的朋友），或者城市之间的公路连接（通常是双向的）。
*   有向图：建模<font color="#ffff00">非对称关系</font>。例如，社交网络中的“关注”关系（A 关注 B 不代表 B 关注 A），或者城市之间的单向街道或直飞航班（可能有去无回）。

如果一条边 $e = \{u, v\}$ (或 $e = (u, v)$) 连接了顶点 $u$ 和 $v$，我们就说这条边**关联 (incident)** 于 $u$ 和 $v$，顶点 $u$ 和 $v$ 是**邻居 (neighbors)** 或**相邻 (adjacent)** 的。

对于无向图，顶点的**度 (degree)** 是与该顶点关联的边的数量。记为 $\text{degree}(u)$。
**Sanity check!** 在一个无向社交网络中，如果边 $\{u, v\}$ 表示 $u$ 和 $v$ 认识，那么顶点的度表示什么？一个度为 0 的顶点叫做**孤立顶点 (isolated vertex)**，它表示什么？
*   顶点的度表示这个人在社交网络中认识的人数。
*   孤立顶点表示一个不认识任何其他人的人。

对于有向图，顶点的度因为边的方向而分为两种：
*   **入度 (in-degree):** 指向顶点 $u$ 的边的数量。
*   **出度 (out-degree):** 从顶点 $u$ 指出的边的数量。
**Sanity check!** 在一个有向社交网络中，如果边 $(u, v)$ 表示 $u$ 认识 $v$，那么顶点的入度和出度表示什么？
*   顶点 $u$ 的入度表示认识 $u$ 的人数。
*   顶点 $u$ 的出度表示 $u$ 认识的人数。

我们通常假定图没有**自环 (self-loops)**，即形如 $\{u, u\}$ 或 $(u, u)$ 的边。除非特别说明，我们讨论的图也没有同一对顶点之间的多重边（哥尼斯堡问题是经典例外）。允许自环和多重边的图称为多重图。

**路径、行走和环 (Paths, walks and cycles)**

在无向图 $G = (V, E)$ 中：
*   **路径 (path):** 是一系列边的序列 $$\{v_1, v_2\}, \{v_2, v_3\}, \dots, \{v_{n-1}, v_n\}$$我们说存在一条路径连接 $v_1$ 和 $v_n$。通常我们讨论的是**简单路径 (simple path)**，这意味着路径中的顶点 $v_1, \dots, v_n$ 是**互不相同**的。在网络通信中，如果想从节点 1 到节点 3，走简单路径是最直接高效的，重复访问中间节点没有意义。
*   **行走 (walk):** 是允许重复访问顶点和边的<font color="#ffff00">边的序列</font>。例如，从 1 走到 3 经过 $$\{1, 2\}, \{2, 1\}, \{1, 4\}, \{4, 3\}$$ 就是一个行走。
*   **环 (cycle) 或 回路 (circuit):** 是一条<font color="#ffff00">简单路径，但起点和终点是同一个顶点</font>。即 $\{v_1, v_2\}, \{v_2, v_3\}, \dots, \{v_{n-1}, v_n\}, \{v_n, v_1\}$，其中 $v_1, \dots, v_n$ 除 $v_1=v_n$ 外互不相同。通常我们说一个环包含 $n$ 个顶点和 $n$ 条边。
*   **旅行 (tour):** 是一个从起点出发并回到起点的行走，且不重复边。

**Sanity check!** Note 中图 3 的 $G_3$ (一个包含 4 个节点的通信网络)。
*   从节点 1 到节点 3 的最短路径是什么？ 路径 $\{1, 2\}, \{2, 3\}$ 或者 $\{1, 4\}, \{4, 3\}$。长度是 2。
*   不重复访问节点的最长路径是什么？ 路径 $\{1, 2\}, \{2, 3\}, \{3, 4\}$ 或者 $\{1, 4\}, \{4, 3\}, \{3, 2\}$ 等等。长度是 3。
*   以节点 1 为起点的环是什么？ 环 $\{1, 2\}, \{2, 3\}, \{3, 4\}, \{4, 1\}$。

**连通性 (Connectivity)**

*   如果图 $G$ 中**任意**两个不同的顶点之间都存在一条路径，那么图 $G$ 是**连通的 (connected)**。通信网络 $G_3$ 是连通的，任何两个节点都能通过通信链路序列互相发送消息。
*   如果图不是连通的，就是**非连通的 (disconnected)**。Note 中给出了一个非连通网络的例子。
**Sanity check!** 为什么通信网络不希望是非连通的？
*   如果通信网络是非连通的，那么某些节点之间将无法通信，无法发送或接收消息。

任何图（即使是非连通图）都可以分解为若干个**连通分量 (connected components)**。每个连通分量是一个顶点的集合，集合内的所有顶点互相连通，但与集合外的任何顶点都不连通。Note 中非连通图有三个连通分量：$$V_1=\{1, 2, 3\}, V_2=\{4\}, V_3=\{5, 6, 7\}$$

### 重访哥尼斯堡：欧拉回路 (Eulerian Tours)

现在我们用图论的语言重新表述哥尼斯堡七桥问题：给定一个图 $G$（哥尼斯堡的抽象），是否存在一个**行走**恰好使用图中的**每条边一次**？这种行走叫做**欧拉行走 (Eulerian walk)**。如果一个欧拉行走是闭合的（起点和终点相同），则称为**欧拉回路 (Eulerian tour)**。哥尼斯堡七桥问题就是问：这个图是否有欧拉回路？

欧拉定理给出了欧拉回路存在的精确条件。

**定理 5.1 (欧拉定理):** 一个无向图 $G = (V, E)$ 存在欧拉回路当且仅当 $G$ 是**偶度图 (even degree)** (所有顶点都有偶数度) 并且是**连通的** (可能除了孤立顶点)。

**证明思路:**
我们需要证明两个方向：“仅当” (只有满足条件才有) 和“如果” (如果满足条件就一定有)。

*   **“仅当” (Only if):** 假设 $G$ 有一个欧拉回路。
    *   **连通性:** 如果一个顶点有一条边连着（非孤立顶点），那么它一定在欧拉回路上。欧拉回路会经过所有非孤立顶点和所有边。所以所有非孤立顶点之间都是连通的。
    *   **偶数度:** 考虑欧拉回路经过任何一个顶点 $v$ (不是起点/终点)。每次回路“进入” $v$ 沿着一条边，就必须“离开” $v$ 沿着另一条**不同**的边（因为每条边只能用一次）。所以进入和离开的边可以两两配对。对于起点/终点 $s$，它第一次离开 $s$ 的边没有配对，但最后一次回到 $s$ 的边可以与它配对。因此，所有与顶点关联的边都可以两两配对，所以每个顶点的度都是偶数。

*   **“如果” (If):** 假设 $G$ 是偶度图且连通（忽略孤立顶点）。我们需要证明存在一个欧拉回路。这里我们用**构造性证明**：给出一个算法来找到它，并用归纳法证明算法是正确的。
    *   **辅助函数 `FIND_TOUR(G, s)`:** 从顶点 $s$ 开始，沿着未走过的边任意走，直到无法继续（当前顶点没有未走过的关联边了）。
    *   **Claim:** `FIND_TOUR(G, s)` 必须回到 $s$ 才能停下来。
    *   **Claim 证明思路:** 考虑除了起点 $s$ 之外的任何顶点 $v \ne s$。每次行走进入 $v$，都会使用一条入边。如果停留，必须使用一条出边。在行走过程中，每当行走进入 $v$ 又离开 $v$，就会用到两条与 $v$ 关联的边。这些边可以两两配对。当行走第一次进入 $v$ 时，用了一条边。之后每次进出用两条。所以当行走离开 $v$ 时，与 $v$ 关联且被走过的边总数是偶数；当行走停留在 $v$ 时，被走过的边总数是奇数。因为所有顶点的度都是偶数，如果停留在 $v \ne s$，那么与 $v$ 关联的总边数是偶数，被走过的边数是奇数，这就意味着还有未走过的边关联于 $v$（偶 - 奇 = 奇，至少剩下一条）。所以只要 $v \ne s$，它就不可能因为没有未走过的关联边而停下来。只有在 $s$ 点，第一次从 $s$ 出发用了一条边（走过边数是奇数）。之后每次进出 $s$ 都用两条（总走过边数奇 + 偶 = 奇）。最后回到 $s$ 时，用了一条边（总走过边数奇 + 奇 = 偶）。所以只有在 $s$ 点，被走过的边数总能达到偶数，使得剩余未走边可能是 0。因此，只能停在 $s$。
    *   `FIND_TOUR(G, s)` 找到一个以 $s$ 为起点和终点的旅行（可能不是欧拉回路，因为它可能没走完所有边）。
    *   **主算法 `EULER(G, s)`:**
        1.  调用 `T = FIND_TOUR(G, s)` 找到一个以 $s$ 为起点的旅行 $T$。
        2.  从 $G$ 中移除 $T$ 的所有边。剩余的图可能包含多个连通分量 $G_1, G_2, \dots, G_k$。
        3.  对于每个连通分量 $G_i$，找到它与旅行 $T$ 的**第一个**交点 $s_i$（即在 $T$ 中第一次遇到的属于 $G_i$ 的顶点）。
        4.  对于每个 $G_i$，递归调用 `EULER(G_i, s_i)` 找到 $G_i$ 的欧拉回路 $T_i$。
        5.  使用 `SPLICE(T, T_1, ..., T_k)` 将 $T$ 和所有 $T_i$ 拼接起来。拼接的方法是：沿着 $T$ 走，每当走到一个顶点 $s_i$（它也是某个 $G_i$ 的顶点）时，**暂停**走 $T$，转而走完 $T_i$（从 $s_i$ 出发并回到 $s_i$），然后继续沿着 $T$ 原来的路径走。拼接后的旅行就是所有边的并集。
    *   **EULER 算法的归纳证明 (归纳对象：图的边数 $m$):**
        *   **基础情况 (m=0):** 图没有边，欧拉回路是空回路。成立。
        *   **归纳假设:** 对于边数至多为 $m$ 的偶度连通图，`EULER` 算法能找到欧拉回路。
        *   **归纳步骤:** 考虑一个有 $m+1$ 条边的偶度连通图 $G$。调用 `T = FIND_TOUR(G, s)`。 $T$ 是一个旅行，所以 $T$ 本身每个顶点都是偶度。从 $G$ 中移除 $T$ 的边后，剩余图 $G'$ 仍然是偶度图（原图偶度 - $T$ 的偶度 = 偶度）。$G'$ 可能非连通，其连通分量是 $G_1, \dots, G_k$。每个 $G_i$ 都是偶度连通图，并且边数少于 $m+1$。同时，由于原图 $G$ 连通且 $T$ 不能覆盖所有边（除非 $k=0$），每个 $G_i$ 中一定有顶点在 $T$ 上（否则 $G_i$ 与 $T$ 代表的图不连通，与原图 $G$ 连通矛盾）。所以在 $T$ 上能找到与每个 $G_i$ 相交的第一个顶点 $s_i$。对每个 $G_i$ 递归调用 `EULER(G_i, s_i)`，根据归纳假设，能找到 $G_i$ 的欧拉回路 $T_i$。最后 `SPLICE` 将 $T$ 和所有 $T_i$ 拼接。拼接后的旅行包含了 $T$ 的所有边和所有 $T_i$ 的所有边，也就是 $G$ 的所有边。由于每个 $T_i$ 都是回路且从 $s_i$ 出发回到 $s_i$ 后继续走 $T$，最终会回到 $T$ 的起点 $s$。所以拼接后的路径是一个包含所有边的回路，即欧拉回路。算法正确。$\square$

**Sanity check!** 为什么定理 5.1 说明哥尼斯堡七桥问题无解？
*   欧拉抽象出的哥尼斯堡图 (图 1(b)) 中，顶点 A, B, C, D 的度数分别是 3, 5, 3, 3。都是奇数！根据定理 5.1 的“仅当”部分，如果存在欧拉回路，所有顶点必须是偶度。这与实际情况矛盾。所以不存在欧拉回路。

Note 中的练习 1 提到了德布鲁因序列 (de Bruijn sequence) 和德布鲁因图 (de Bruijn graph)，并说明德布鲁因序列可以通过德布鲁因图的欧拉回路生成。它还给出了有向图欧拉回路的条件：<font color="#ffff00">每个顶点的入度等于出度</font> *这也意味着其链接为 $n*2*x$*，是为偶数。
这是一个非常好的应用例子，展示了抽象的图论概念如何解决实际的序列生成问题。

### 平面图 (Planar Graphs)

一类特别重要的图是**平面图 (planar graph)**。一个图是平面图，如果它能**在平面上绘制出来而没有边的交叉**。图 3 中的 (i)-(iv) 是平面图，(v)-(vii) 不是。注意 (i) 和 (ii) 是同一个图的不同画法，尽管 (ii) 有交叉，但因为它**存在**没有交叉的画法，所以它仍然是平面图。

平面图在很多领域都有应用，比如电路设计（希望元件连接线不交叉）或地图绘制。很多在一般图上计算量很大的问题，在平面图上却能高效解决。

当一个平面图被画在平面上时，它将平面分成了若干个区域，这些区域称为图的**面 (faces)**。其中一个面是无限大的（外部区域），其他的面是有限的。我们用 $v$ 表示顶点数， $e$ 表示边数，$f$ 表示面数。
例如，图 3 (i) $v=4, e=6, f=4$。图 3 (iv) (立方体) $v=8, e=12, f=6$。

平面图有一个非常基本和重要的性质，叫做**欧拉公式 (Euler's formula)**：
$$v + f = e + 2$$
对上面的例子验证一下：
图 3 (i): $4 + 4 = 6 + 2 \implies 8 = 8$. 成立。
图 3 (iv): $8 + 6 = 12 + 2 \implies 14 = 14$. 成立。
欧拉公式对所有无“洞”的多面体也成立（多面体可以看作特殊的平面图）。

**练习:** 你能看出平面图如何推广多面体吗？为什么所有无“洞”的多面体都是平面图？
*   多面体是三维空间中的立体。将多面体投影到二维平面上，它的顶点、棱和面分别对应平面图的顶点、边和面。例如，立方体可以“展开”成一个平面图形，这就是一个平面图。<font color="#ffff00">只要多面体表面是连通且没有洞的，它的骨架（顶点和棱）就可以对应一个连通的平面图</font>。

**定理 5.2 (欧拉公式):** 对于每一个连通的平面图，都有 $v + f = e + 2$。

**证明思路 (对边数 $e$ 进行归纳):**
**基础情况 (e=0):** 图没有边，因为是连通图，只能是一个孤立顶点。$v=1, e=0$。此时只有一个面（整个平面）。$f=1$。公式 $v + f = e + 2$ 变为 $1 + 1 = 0 + 2$，即 $2 = 2$。成立。
**归纳假设:** 假设对于边数至多为 $e$ 的连通平面图，欧拉公式成立。
**归纳步骤:** 考虑一个有 $e+1$ 条边的连通平面图 $G$ ($e \ge 0$, 所以 $e+1 \ge 1$)。
*   **情况 1: 图 $G$ 是一棵树 (tree)。** 树是一种没有环的连通图（我们下一节会详细介绍）。树的特殊之处在于，在平面上绘制一棵树，它不会把平面分成多个区域，只有一个面（无限面）。所以 $f=1$。同时，树的一个重要性质是它的边数 $e = v-1$（下一节会证明）。将 $f=1$ 和 $e=v-1$ 代入欧拉公式：$v + 1 = (v-1) + 2$，即 $v+1=v+1$。成立。
*   **情况 2: 图 $G$ 不是一棵树。** 因为 $G$ 是连通的但不是树，根据树的定义，它一定**包含至少一个环**。在 $G$ 中找到一个环，并移除环上的任意一条边。移除一条边后，图的顶点数 $v$ 不变，边数 $e$ 减 1。因为这条边在一个环上，移除它不会导致图断开，所以新的图 $G'$ 仍然是连通的。同时，$G'$ 仍然可以在平面上无交叉地绘制出来（因为只是移除了一条边），所以 $G'$ 也是平面图。移除环上的一条边会使得它所连接的两个面**合并**成一个大面，所以面数 $f$ 也减 1。
    现在，图 $G'$ 是一个连通平面图，有 $e$ 条边。根据归纳假设，欧拉公式对 $G'$ 成立：$(v) + (f-1) = (e-1) + 2$。展开得到 $v + f - 1 = e - 1 + 2$，即 $v + f - 1 = e + 1$。两边同时加 1，得到 $v + f = e + 2$。这正是原图 $G$ 的欧拉公式。
根据归纳法，欧拉公式对所有连通平面图成立。$\square$

**练习:** 如果图不连通呢？连通分量的数量如何进入公式？
*   如果一个图有 $k$ 个连通分量 $G_1, \dots, G_k$，每个 $G_i$ 是连通平面图，有 $v_i$ 个顶点，$e_i$ 条边，$f_i$ 个面。总顶点数 $v = \sum v_i$，总边数 $e = \sum e_i$。对于每个 $G_i$， $v_i + f_i = e_i + 2$. 将所有分量的公式相加：$\sum v_i + \sum f_i = \sum e_i + 2k$，即 $v + \sum f_i = e + 2k$. 然而，面数的统计需要小心。只有无限面是被所有连通分量共享的。所以总面数 $f = (\sum f_i) - (k-1)$ (每个分量贡献一个无限面，但这些无限面是同一个，所以要减去 $k-1$ 个重复)。代入：$v + (f + k - 1) = e + 2k$，即 $v + f = e + k + 1$. 所以对于一般平面图，$v + f = e + k + 1$，其中 $k$ 是连通分量数。

**平面图的边数限制**

欧拉公式可以用来推导平面图的边数不能太多，从而帮助我们判断一些图是否是平面图。
考虑一个平面图有 $f$ 个面。每个面有多少条边构成它的边界（称为面的“边数”或“度”）。注意一条边可能被同一个面算两次（如果它是桥，连接的面是同一个），或者被两个不同的面各算一次。将所有面的边数加起来 $\sum_{i=1}^f s_i$，每条边恰好被算两次（因为每条边连接两个面，或者在自环和桥的情况下连接同一个面两次）。所以 $\sum_{i=1}^f s_i = 2e$。

在一个不含多重边的简单图（没有自环和多重边）中，除非图边数少于 2（即只有 0 或 1 条边），否则每个面至少有 3 条边构成的边界（因为两条边只能形成一个角或一条线，不能围成一个面）。所以 $s_i \ge 3$ 对于所有面 $i$ (如果图有至少 3 个顶点)。
由此得到 $3f \le \sum s_i = 2e$。即 $f \le 2e/3$。
将欧拉公式 $f = e - v + 2$ 代入不等式 $3f \le 2e$：
$3(e - v + 2) \le 2e$
$3e - 3v + 6 \le 2e$
$e \le 3v - 6$
这是一个重要结论：对于任何顶点数 $v \ge 3$ 的简单连通平面图，边数 $e$ 不超过 $3v-6$。如果图不连通， $e$ 会更少。

**应用：判断 $K_5$ 非平面**
完全图 $K_n$ 是 $n$ 个顶点，任意两点之间都有边的无向图。 $K_5$ 有 $v=5$ 个顶点。边数 $e = \binom{5}{2} = \frac{5 \times 4}{2} = 10$。
代入不等式 $e \le 3v-6$: $10 \le 3(5) - 6 = 15 - 6 = 9$。即 $10 \le 9$。这是**假**的。
所以 $K_5$ 不满足平面图的边数上限，因此 $K_5$ 是**非平面图**。

**应用：判断 $K_{3,3}$ 非平面**
完全二分图 $K_{m,n}$ 是一个图，顶点分为两组，一组 $m$ 个顶点，另一组 $n$ 个顶点，任意一组的顶点与另一组的任意顶点之间都有边，但同组顶点之间没有边。 $K_{3,3}$ 有 $v = 3+3=6$ 个顶点。边数 $e = 3 \times 3 = 9$。
代入不等式 $e \le 3v-6$: $9 \le 3(6) - 6 = 18 - 6 = 12$。即 $9 \le 12$。这个不等式是**真**的。所以 $e \le 3v-6$ **不能**证明 $K_{3,3}$ 非平面。我们需要更强的条件。

观察 $K_{3,3}$ 的结构：顶点分为两组，边只在组之间。任何环必须交替经过两组顶点。所以 $K_{3,3}$ 中**没有奇数长度的环**，特别是没有长度为 3 的环（三角形）。
如果一个平面图没有长度为 3 的环，那么它的每个面至少有 4 条边（$s_i \ge 4$）。
由此得到 $4f \le \sum s_i = 2e$。即 $f \le e/2$。
将欧拉公式 $f = e - v + 2$ 代入不等式 $4f \le 2e$：
$4(e - v + 2) \le 2e$
$4e - 4v + 8 \le 2e$
$2e \le 4v - 8$
$e \le 2v - 4$
这个不等式适用于所有不含三角形的连通平面图。
现在将 $K_{3,3}$ ($v=6, e=9$) 代入 $e \le 2v-4$: $9 \le 2(6) - 4 = 12 - 4 = 8$。即 $9 \le 8$。这是**假**的。
所以 $K_{3,3}$ 不满足这个更强的平面图边数上限，因此 $K_{3,3}$ 是**非平面图**。

**库拉托夫斯基定理 (Kuratowski's Theorem)**

$K_5$ 和 $K_{3,3}$ 是非平面图的两个基本“障碍”。库拉托夫斯基定理指出，一个图是非平面的，**当且仅当**它“包含” $K_5$ 或 $K_{3,3}$。这里的“包含”是指图包含 $K_5$ 或 $K_{3,3}$ 的**细分 (subdivision)**。一个图的细分是通过在边上插入新的顶点（度为 2 的顶点）得到的。例如，将 $\{u, v\}$ 替换为 $\{u, w\}, \{w, v\}$。
一个图包含 $K_5$ 或 $K_{3,3}$ 的细分，意味着你可以从原图中找出一些顶点（对应 $K_5$ 或 $K_{3,3}$ 的顶点），以及连接这些顶点的路径（对应 $K_5$ 或 $K_{3,3}$ 的边），这些路径除了端点外互不相交。
图 4 展示了如何在 4 维超立方体中找到 $K_{3,3}$ 的细分，这说明 4 维超立方体是非平面的。

库拉托夫斯基定理的“如果包含 $K_5$ 或 $K_{3,3}$ 细分则非平面”方向比较直观：因为 $K_5$ 和 $K_{3,3}$ 非平面，通过插入度为 2 的顶点不会改变图的平面性，所以包含它们细分的图也非平面。另一个方向（非平面图一定包含它们细分）则非常难证明。

### 特定图类型：完全图、树和超立方体

除了抽象的图概念，有些特定结构的图因为其重要性质而被广泛研究。

想象一下设计互联网的骨干网络。为了能从任何一台路由器发送数据包到另一台，网络必须是连通的。但仅仅连通可能不够，如果某些连接不稳定，一旦断开可能导致网络分裂。
*   最“省”连接的网络是**树 (tree)**，它只用最少的边实现连通，但移除任意一条边都会断开。
*   最“全”连接的网络是**完全图 (complete graph)**，任意两点都有边，连接最鲁棒，但边数巨大。
*   **超立方体 (hypercube)** 则在连接鲁棒性和边数之间提供了一种很好的平衡。

我们来详细看看这三类图。

**4.1 完全图 (Complete graphs)**

$n$ 个顶点的完全图 $K_n$ 是任意两个不同顶点之间都有一条边的无向图。
图示 $K_2, K_3, K_4$。
$K_n$ 的顶点数 $v = n$。
**Sanity check!**
1.  画出 $K_6$？ 6 个点，任意两点连线。
2.  $K_n$ 中每个顶点的度是多少？每个顶点都与其余 $n-1$ 个顶点相连，所以度是 $n-1$。
3.  $K_n$ 有多少条边？每个顶点度是 $n-1$，总度数是 $n(n-1)$。每条边在总度数中被算两次，所以边数 $e = \frac{n(n-1)}{2}$。验证 $K_6$ ($v=6$) 的边数是 $\frac{6 \times 5}{2} = 15$。
**Sanity check!** 从 $K_n$ 中最少移除多少条边能使它非连通？为了使图非连通，最简单的方式是移除所有连接某个顶点与其他顶点的边，使其成为孤立顶点。这需要移除 $n-1$ 条边。所以至少需要移除 $n-1$ 条边。

**4.2 树 (Trees)**

树可以看作“最小连通图”。移除任何一条边都会断开。关于树有很多等价的定义：
1.  $G$ 是连通的且不包含环。
2.  $G$ 是连通的且有 $n-1$ 条边（$n$ 是顶点数）。
3.  $G$ 是连通的，且移除任何一条边都会使 $G$ 断开。
4.  $G$ 不包含环，且添加任何一条边都会创建一个环。

Note 中给出了三个树的例子。
**Sanity check!**
1. 验证这些图是否满足所有定义。例如，数数顶点和边，检查连通性和是否有环。
2. 举一个**不是**树的图的例子。一个有环的连通图（比如一个正方形，v=4, e=4），一个非连通图（比如两个独立的点，v=2, e=0）。

为什么研究树？树结构简单，许多在一般图上难的问题在树上容易解决。树也自然地模拟许多层级关系，比如家谱、文件系统结构、生物分类等。

**有根树 (Rooted Tree):** 树中指定一个顶点作为**根 (root)**。通常把根画在最上面。没有子节点的节点是**叶子 (leaves)**，其他的节点是**内部节点 (internal nodes)**。树的**深度 (depth)** 是从根到最远叶子的最长路径长度。可以分层或分级，第 $k$ 层包含与根距离（路径长度）为 $k$ 的顶点。Note 中给了一个有根树的例子。
**Sanity check!**
1. 上面树的深度是多少？根到 8, 9, 10, 11, 12, 13, 14, 15 的路径长度是 3。深度是 3。
2. 哪些顶点在第 0 层？根节点 1。第 3 层？叶子节点 8 到 15。

有根树的应用：细胞分裂过程（一个细胞分裂为两个子细胞），二叉搜索树（一种数据结构，用于快速查找有序元素）。

**证明树的等价定义 (定义 1 <=> 定义 2):**
**定理 5.4:** “G 是连通的且不包含环” 和 “G 是连通的且有 $n-1$ 条边” 是等价的。
**证明思路:** 分两部分证明。

*   **正向证明 (定义 1 => 定义 2):** 用**强归纳法**证明：如果 $G$ 是连通的且不含环，则 $G$ 是连通的且有 $n-1$ 条边。归纳对象是顶点数 $n$。
    *   **基础情况 (n=1):** 图只有 1 个顶点，没有边。$e=0$。连通且无环。 $e = n-1$ 变为 $0 = 1-1$。成立。
    *   **归纳假设:** 对于顶点数 $1 \le n \le k$ 的连通无环图，边数是 $n-1$。
    *   **归纳步骤:** 考虑顶点数 $n=k+1$ 的连通无环图 $G$。移除任意一个顶点 $v$ 及其关联的边，得到图 $G'$。移除顶点不会产生新环，所以 $G'$ 无环。移除顶点可能使图断开。Note 中只展示了 $G'$ 仍然连通的情况（更复杂的多连通分量情况留作练习）。
        *   **Case 1: $G'$ 是连通的。** $G'$ 有 $k$ 个顶点，连通且无环。根据归纳假设，$G'$ 有 $k-1$ 条边。现在把 $v$ 加回 $G'$。因为原图 $G$ 是无环的，如果 $v$ 在 $G$ 中与 $G'$ 中多于一个顶点相连，那么由于 $G'$ 是连通的，这多条边会和 $G'$ 中的路径形成环。所以 $v$ 在 $G$ 中只能与 $G'$ 中的**恰好一个**顶点相连。这意味着 $v$ 关联 1 条边。所以 $G$ 的总边数是 $e(G') + 1 = (k-1) + 1 = k$。对于 $n=k+1$ 的图，$n-1 = (k+1)-1=k$。所以边数是 $n-1$。成立。
        *   **Case 2: $G'$ 是非连通的。** 留作练习（需要利用强归纳假设对 $G'$ 的各个连通分量分别应用）。

*   **反向证明 (定义 2 => 定义 1):** 用**反证法**证明：如果 $G$ 是连通的且有 $n-1$ 条边，则 $G$ 是连通的且不包含环。
    *   **假设:** $G$ 是连通的，有 $n-1$ 条边，**但**包含一个环。
    *   在一个环中，移除环上的任意一条边**不会**使图断开（环上剩余的边提供了替代路径）。
    *   所以，从 $G$ 中移除环上的一条边，得到新图 $G'$。$G'$ 仍然是连通图，顶点数 $n$ 不变，边数变为 $n-1 - 1 = n-2$。
    *   但我们知道（并将在练习中证明）：任何一个有 $n$ 个顶点的连通图，**至少需要 $n-1$ 条边**。
    *   $G'$ 有 $n$ 个顶点和 $n-2$ 条边，它不满足“连通图至少需要 $n-1$ 条边”这个事实。所以 $G'$ 必须是非连通的。
    *   这与我们从 $G$ 移除环上边后 $G'$ 仍然连通的结论矛盾。
    *   因此，最初的假设（$G$ 包含一个环）是错误的。所以 $G$ 必须不包含环。
    *   结合已知 $G$ 是连通的，定义 1 成立。$\square$

**4.3 超立方体 (Hypercubes)**

超立方体图 $Q_n$ 是一种重要的网络结构，它兼顾了连接鲁棒性和适度的边数。
$n$ 维超立方体 $Q_n = (V, E)$ 的顶点集 $V = \{0, 1\}^n$，即所有长度为 $n$ 的二进制字符串。每个顶点由一个唯一的 $n$ 位二进制串标记。
边集 $E$: 两个顶点 $x$ 和 $y$ 之间有边 $\{x, y\}$，当且仅当 $x$ 和 $y$ **恰好在一位上不同**。例如，在 $Q_4$ 中，0000 和 1000 是邻居，但 0000 和 0011 不是。

图示 $Q_1, Q_2, Q_3$:
*   $Q_1$: 顶点 0, 1。边 $\{0, 1\}$。
*   $Q_2$: 顶点 00, 01, 10, 11。边 $\{00, 01\}, \{00, 10\}, \{01, 11\}, \{10, 11\}$ (形成一个正方形)。
*   $Q_3$: 顶点 000 到 111。边连接只差一位的串（形成一个立方体）。

**递归定义:** $n$ 维超立方体可以由 $(n-1)$ 维超立方体递归构建。取两个 $(n-1)$ 维超立方体，一个顶点标记前缀加 0 (0-subcube)，另一个加 1 (1-subcube)。然后，在 0-subcube 中每个顶点 $0x$ 和 1-subcube 中对应的顶点 $1x$ 之间添加一条边。
**Sanity check!** 在 $Q_3$ 中，0-subcube 是顶点 000, 001, 010, 011 组成的 $Q_2$；1-subcube 是 100, 101, 110, 111 组成的 $Q_2$。连接 000-100, 001-101, 010-110, 011-111 这些边。你能用这个方法画 $Q_4$ 吗？ ($Q_4$ 就是两个 $Q_3$，对应顶点之间连接)。

**练习:** 证明 $n$ 维超立方体有 $2^n$ 个顶点。提示：每个顶点是 $n$ 位二进制串，共有多少种不同的 $n$ 位二进制串？

**超立方体的边数:**
**引理 5.1:** $n$ 维超立方体的总边数是 $n 2^{n-1}$。
**证明 1 (用度数):** 每个顶点是一个 $n$ 位二进制串 $x$. 改变 $x$ 的任意一位都会得到一个恰好差一位的新串，这个新串就是 $x$ 的邻居。有 $n$ 个位可以改变，所以每个顶点的度是 $n$。总度数是 $n \times 2^n$。根据握手引理（无向图中总度数是边数的两倍），边数 $e = \frac{\sum \text{degree}(v)}{2} = \frac{n 2^n}{2} = n 2^{n-1}$。$\square$
**证明 2 (用递归):** 设 $E(n)$ 是 $n$ 维超立方体的边数。根据递归定义，$Q_n$ 由两个 $Q_{n-1}$ 构成，并额外连接了 0-subcube 和 1-subcube 中对应顶点之间的边。每个 $Q_{n-1}$ 的边数是 $E(n-1)$。连接两个 subcube 的边有多少？每个 $x \in \{0, 1\}^{n-1}$ 对应一条连接 $0x$ 和 $1x$ 的边，共有 $2^{n-1}$ 个不同的 $x$。所以连接边有 $2^{n-1}$ 条。
$E(n) = 2 E(n-1) + 2^{n-1}$
基础情况 $E(1)=1$ (1 维超立方体是两个点一条边)。
**练习:** 用归纳法证明 $E(n) = n 2^{n-1}$ 满足这个递推关系和基础情况。

**超立方体的连通性:** 超立方体有很好的连通性。即使移除大量边，图仍然可能保持连通。一个衡量连通鲁棒性的指标是**边割 (edge cut)** 的大小：要将图分裂成两个部分，最少需要移除多少条边。超立方体的边割很大。

**定理 5.5:** 设 $S$ 是 $Q_n$ 的顶点集 $V$ 的子集，满足 $|S| \le |V-S|$ (即 $|S| \le 2^{n-1}$)。设 $E_S$ 是连接 $S$ 和 $V-S$ 的边集。则 $|E_S| \ge |S|$。
这个定理意味着，要将一个“小”的顶点子集 $S$ 从图中分离出来，需要移除至少 $|S|$ 条边。
**证明思路 (归纳法):** 归纳对象是维度 $n$。
*   **基础情况 (n=1):** $Q_1$ 是两个顶点 0 和 1，一条边 $\{0, 1\}$。 $|S| \le 2^{1-1}=1$。如果 $|S|=0$， $|E_S|=0 \ge 0$ 成立。如果 $|S|=1$， $S=\{0\}$ 或 $S=\{1\}$。如果 $S=\{0\}$, $V-S=\{1\}$, $E_S=\{\{0,1\}\}$, $|E_S|=1=|S|$. 成立。
*   **归纳假设:** 假设对于 $1 \le n \le k$，定理成立。
*   **归纳步骤:** 考虑 $n=k+1$ 维超立方体 $Q_{k+1}$。设 $S \subseteq V$, $|S| \le 2^{(k+1)-1} = 2^k$. 将 $S$ 中的顶点按其第一个比特位分组：$S_0 = \{x | 0x \in S\}$ (来自 0-subcube), $S_1 = \{x | 1x \in S\}$ (来自 1-subcube)。$|S| = |S_0| + |S_1|$.
    *   **情况 1: $|S_0| \le 2^{k-1}$ 且 $|S_1| \le 2^{k-1}$。**
        将 $S_0$ 看作 $Q_k$ (0-subcube) 的子集，其大小 $\le 2^{k-1}$。根据归纳假设，在 0-subcube 内部连接 $S_0$ 与其补集 $V_0-S_0$ 的边数（这些边都在 $E_S$ 中）至少是 $|S_0|$。类似地，在 1-subcube 内部连接 $S_1$ 与 $V_1-S_1$ 的边数至少是 $|S_1|$。连接 $S$ 和 $V-S$ 的总边数 $|E_S| \ge (\text{Q0 内部交叉边}) + (\text{Q1 内部交叉边}) + (\text{Subcube 之间交叉边}) \ge |S_0| + |S_1| + 0 = |S|$. 定理成立。
    *   **情况 2: $|S_0| > 2^{k-1}$ 或 $|S_1| > 2^{k-1}$。** 不失一般性，假设 $|S_0| > 2^{k-1}$。
        因为 $|S| = |S_0| + |S_1| \le 2^k$，所以 $|S_1| = |S| - |S_0| < 2^k - 2^{k-1} = 2^{k-1}$。所以 $|S_1| \le 2^{k-1}$。
        将 $S_1$ 看作 $Q_k$ (1-subcube) 的子集， $|S_1| \le 2^{k-1}$。根据归纳假设，在 1-subcube 内部连接 $S_1$ 与 $V_1-S_1$ 的边数 $\ge |S_1|$.
        将 $V_0-S_0$ 看作 $Q_k$ (0-subcube) 的子集。 $|V_0-S_0| = |V_0| - |S_0| = 2^k - |S_0|$. 因为 $|S_0| > 2^{k-1}$，所以 $|V_0-S_0| < 2^{k-1}$。根据归纳假设，在 0-subcube 内部连接 $S_0$ 与 $V_0-S_0$ 的边数 $\ge |V_0-S_0| = 2^k - |S_0|$.
        现在考虑连接两个 subcube 的边 $(0x, 1x)$。这样的边有多少条在 $E_S$ 中？这些边连接 $S$ 和 $V-S$。也就是说，连接 $S_0$ 和 $V_1-S_1$，或者连接 $S_1$ 和 $V_0-S_0$。Note 中给出的跨 subcube 边的数量是 $|S_0| - |S_1|$ (当 $|S_0|>|S_1|$时，这个值 $>0$)。为什么是这个值需要更仔细分析，但核心思想是利用 $|S_0|$ 远大于 $|S_1|$ 且 $|S_0| > 2^{k-1}$ 的性质来得到一个跨 subcube 边的下界。
        假设跨 subcube 边的数量至少是 $|S_0| - |S_1|$。
        总边数 $|E_S| \ge (\text{Q0 内部交叉}) + (\text{Q1 内部交叉}) + (\text{跨 subcube 交叉})$
        $|E_S| \ge (2^k - |S_0|) + |S_1| + (|S_0| - |S_1|) = 2^k$.
        因为我们处于 Case 2 ($|S_0| > 2^{k-1}$) 下，并且已知 $|S| \le 2^k$，所以 $2^k \ge |S|$. 这样 $|E_S| \ge 2^k \ge |S|$. 定理成立。
        这个证明的精髓在于，将问题分解到子问题 (subcubes) 中，利用归纳假设得到子问题内部的切割边数下界，再分析连接子问题之间的边数，并叠加起来。

超立方体是很多并行计算机和网络路由算法的基础模型，它的良好连通性是其重要性质。

### 练习问题

Note 中提供了几个练习题：
1.  德布鲁因序列和图：理解有向图欧拉回路条件的应用。
2.  完成树的等价定义证明中移除顶点导致多连通分量的情况：这需要仔细应用强归纳法到每个连通分量。
3.  证明连通图至少有 $n-1$ 条边：这是一个基本事实，可以用归纳法或反证法结合路径概念来证明。

### 知识点总结与要点提炼

*   **图是抽象工具：** 用顶点和边表示实体及其关系，建模网络结构。
*   **基本概念：** 无向图 vs 有向图、顶点、边、度（入度/出度）、邻居、路径、行走、环、连通性、连通分量。
*   **欧拉回路：** 遍历每条边恰好一次并回到起点。**欧拉定理：** 存在欧拉回路 $\iff$ 图是偶度且连通（非孤立点）。
*   **平面图：** 可以在平面上无交叉绘制的图。
*   **欧拉公式 (平面图):** 对于连通平面图，$v + f = e + 2$。
*   **平面图的边数限制：** $e \le 3v-6$ (简单图)， $e \le 2v-4$ (不含三角形的简单图)。可用于证明图的非平面性（如 $K_5, K_{3,3}$）。
*   **库拉托夫斯基定理：** 图非平面 $\iff$ 包含 $K_5$ 或 $K_{3,3}$ 的细分。
*   **特定图类型：**
    *   **完全图 $K_n$：** 任意两点有边，边数最多 ($\binom{n}{2}$)，连接鲁棒。
    *   **树：** 连通且无环，边数最少 ($n-1$)，连接脆弱，有多等价定义。
    *   **超立方体 $Q_n$：** 顶点是 $n$ 位二进制串，边连一位差的顶点，$2^n$ 顶点，$n 2^{n-1}$ 边，递归结构，良好连通鲁棒性。

### 学科思想与延伸思考

图论完美体现了离散数学的魅力：用简单的离散结构（点和线）捕捉复杂系统的精髓。欧拉定理的证明展示了数学的严谨和美妙，特别是“如果”部分的构造性证明，它不仅告诉我们“存在”，还指明了“如何找到”。平面图的欧拉公式及其推论则提供了强大的工具，通过简单的计数关系揭示图结构的深层性质。树和超立方体的例子展示了如何根据不同需求（最小连接、最大连接、平衡连接）设计特定的图结构。超立方体连接性定理的证明更是递归和归纳思想在图论中的精彩应用。

图论是许多计算机科学领域的基础，比如算法（图遍历、最短路径、最小生成树）、网络、数据库、机器学习（图神经网络）等等。对图论的深入理解将为你打开通往这些领域的大门。

希望这次图论初步的探索能激发大家的兴趣！图论的世界广阔而迷人，我们今天只是触及了皮毛。后面的课程中，我们还会继续深入，学习更多图的性质和强大的图算法。