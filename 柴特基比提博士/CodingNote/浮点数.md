# "浮点"是什么?
浮点数的“浮点”这个称号，来源于其数值表示方法中小数点（或“点”）的位置是“浮动”的。与整数不同，浮点数使用一种特殊的表示法，使得它们能够表示非常大的数和非常小的数。这种表示法类似于科学计数法，但在计算机中有具体的存储形式。

### 1. “点”指的是小数点的位置
在十进制数中，小数点的位置决定了数值的大小。例如：
- `123.45` 表示一百二十三点四五
- `0.00123` 表示零点零零一二三

科学计数法通过调整小数点的位置来表示大小不同的数值，比如 `1.23 × 10^2` 表示 `123`，而 `1.23 × 10^-3` 表示 `0.00123`。计算机中的浮点数用类似的方式表示数值，只是使用的是二进制而不是十进制。

### 2. 浮动的小数点：如何浮动的？
浮点数的存储格式是根据 IEEE 754 标准实现的，它包含三个部分：
- **符号位**：表示数的正负。
- **指数部分**：用于控制小数点的位置，这里就是“浮动”的原因。
- **尾数（或有效位）部分**：表示数值的精确部分（有效数字）。

浮动的小数点的实现方式是通过指数来控制的。指数部分指定了尾数部分应向左或向右移动多少位，以达到所需的数值大小。这样，小数点的位置可以“浮动”到不同的数值范围，因而称为“浮点”。

#### 举例说明
比如，假设一个浮点数用科学计数法表示为 `1.23 × 10^5`，这表示 `123000`。而 `1.23 × 10^-5` 则表示 `0.0000123`。在这两个例子中，小数点的位置是由指数 `5` 或 `-5` 控制的，使得同样的尾数 `1.23` 可以表示非常大或非常小的数值。

在计算机中，同样的道理适用，浮点数表示为：
$$
(-1)^{\text{符号}} \times \text{尾数} \times 2^{\text{指数}}
$$
尾数部分相当于科学计数法中的有效数字，而指数部分决定了小数点的移动位置，使得小数点可以“浮动”到合适的位置。

### 3. 为什么需要浮点数？
整数类型只能表示固定范围的整数，而浮点数可以在广泛的数值范围内表示非常大的数和非常小的数，这对科学计算、工程应用等领域非常重要。例如，`0.00000000000000123` 和 `123000000000000` 都可以用浮点数表示，而整数很难直接表示这样的数。

### 4. 浮点数的局限性
由于浮点数的小数点位置是浮动的，其精度有限，尤其是当数值范围变大时，精度会随之降低。浮点数只能表示有限的有效数字（`float` 大约 7 位，`double` 大约 15-16 位），超出精度范围的部分会被截断或舍入。这也是浮点运算容易产生舍入误差的原因。

### 总结
- **“点”**：指的是数值表示中的小数点。
- **“浮动”**：通过指数来控制小数点的位置，从而扩大数值范围。
- **优势**：可以表示非常大或非常小的数值。
- **局限**：精度有限，容易产生舍入误差。

通过浮动小数点的位置，浮点数实现了比固定点数更大的数值范围，使其成为计算机中数值运算的常见选择。

在IEEE 754标准中，**32位浮点数（float）和64位浮点数（double）**都使用了**隐藏位**（也称<font color="#ffff00">隐含位、隐含的1位，implicit bit</font>）设计。这一设计可以让浮点数表示的精度更高，节省存储空间。
# 隐藏位
## 0.[[IEEE浮点数计算]]
### 1. 隐藏位是什么？
在IEEE 754浮点数标准的尾数（又称**尾数部分**或**有效位部分**，mantissa 或 significand）中，**隐藏位**指的是一个不显式存储的“1”，即尾数的第一个有效数字。

- 对于[[标准化的浮点数]]（normalized floating point number），其尾数部分总是以“1”开头。因此，IEEE 754标准没有将这个“1”存储在浮点数的位结构中，而是假定它的存在。
- 这样，通过默认第一个有效位为“1”，可以省略存储这一位，从而节省存储空间。

### 2. 为什么需要隐藏位？
隐藏位的设计是基于浮点数的科学计数法表示中的一种优化。例如：
- 一个标准化的二进制浮点数可以表示为 $1.xxx \times 2^n$ 的形式，即尾数总是以“1”开头。对于一个32位float数，尾数部分实际存储23位，而隐藏位就是省略的第24位“1”。
- 通过假定第一个有效位始终为“1”，可以节省一位的存储，从而在不增加存储位数的情况下提高精度。

例如，对于一个float类型数 `1.101` 的二进制表示，可以省略这个“1”，将后续的`101`存储在尾数中。实际计算时再恢复为 `1.101` 进行运算。

### 3. 隐藏位的意义和作用
- **提高精度**：隐藏位使得尾数部分可以表示更多有效数字。例如，在32位float中，虽然只有23位用于尾数存储，加上隐藏位后，相当于24位精度。
- **节省空间**：通过省略始终为1的这一位，隐藏位设计让尾数部分多出一位来存储其他信息，从而节省存储空间。
- **简化标准化数的表示**：IEEE 754标准要求标准化数的尾数总是以“1”开头，隐藏位正好利用这一规则，使得数的表示更加简洁统一。

### 4. 非标准化数（Subnormal Numbers）没有隐藏位
非标准化数（即次正规数或非正规数，subnormal numbers，也叫 denormalized numbers）没有隐藏位，因为它们的尾数不满足“总以1开头”的要求。次正规数用于表示非常接近于零的小数，它们的尾数部分以“0”开头，所以不能假定第一个有效位为“1”。

### 5. 示例说明隐藏位的作用
假设一个32位float数在二进制下的表示如下：
- **符号位**：0（正数）
- **指数部分**：`10000001`，即偏移后为`2^1`
- **尾数部分**：`01000000000000000000000`（23位）

在这种表示下，这个数的值为：
$$
(+1) \times (1.01000000000000000000000) \times 2^1
$$
其中`1.`的第一位就是隐藏位。

### 总结
- **隐藏位**是IEEE 754标准中用来表示浮点数尾数的一个隐含的“1”，即尾数部分的第一个有效位。
- 这种设计提升了浮点数的精度和存储效率，在相同位数的情况下可以表示更精确的数值。
- 非标准化数不使用隐藏位，因此当浮点数接近于零时，尾数部分的存储精度会有所降低。

# 指数的偏移原理
浮点数的**“偏移”**（也称为**偏移量**或**偏置值**，bias）是指在IEEE 754标准的浮点数表示中，对指数部分进行偏移处理，以便在二进制表示中方便地表示正数和负数的指数。偏移的引入可以确保指数既能表示正值，也能表示负值，从而使得浮点数能够覆盖从非常小到非常大的范围。接下来我们详细解释这一概念，并讨论其与计算机中的补码的关系。

### 1. 为什么需要偏移？
在IEEE 754浮点数表示中，数值的一般形式为：
$$
(-1)^{\text{sign}} \times 1.\text{mantissa} \times 2^{\text{exponent} - \text{bias}}
$$
其中：
- **sign**（符号位）：表示正数或负数。
- **mantissa**（尾数或有效数位）：用来表示数值的精度部分。
- **exponent**（指数）：表示浮点数的放大或缩小程度。
- **bias**（偏移量）：一个固定的常数，用来平移指数的取值范围，以便能够表示正、负指数。

#### 举例说明
- 对于32位float（单精度浮点数），指数部分占8位，偏移量是 **127**。
- 对于64位double（双精度浮点数），指数部分占11位，偏移量是 **1023**。

假设一个32位float浮点数的指数部分为`10000000`（即128），则实际的指数值为：
$$
128 - 127 = 1
$$
这意味着该浮点数的指数实际是`2^1`。

### 2. 如何使用偏移表示正负指数？
假如没有偏移，指数部分在二进制下只能表示非负整数（因为计算机只能处理正数位的整数）。通过引入偏移值，我们可以在指数部分用无符号整数的形式来表示负数和正数的指数。

**偏移量的计算**：
- 假设指数有 \( N \) 位，偏移量为 \( 2^{N-1} - 1 \)。
  - 对于float（8位指数）：偏移量 \( = 2^{8-1} - 1 = 127 \)。
  - 对于double（11位指数）：偏移量 \( = 2^{11-1} - 1 = 1023 \)。

#### 例子
在32位float中：
- 指数部分`01111111`（即127）表示实际指数`0`，即 \( 2^0 \)。
- 指数部分`00000000`（即0）表示实际指数`-127`，即接近于零的非常小数。
- 指数部分`11111111`（即255）表示“特殊值”，如无穷大和NaN（Not a Number）。

### 3. 偏移和补码的关系
偏移与**补码**（two's complement）有相似的作用，都是为了表示正数和负数，但它们的实现方式和使用场景不同：

- **补码**是一种表示负数的编码方式，广泛用于整数表示。补码通过翻转所有位并加1的方式实现负数表示。
- **偏移**则用于浮点数指数的正负表示。指数部分实际上是无符号整数，它通过一个偏移量（bias）来将正负指数映射为无符号整数。

**区别在于**：
- 补码主要用于整数的负数表示，并直接参与加减运算。
- 偏移是将指数值变换为无符号整数，避免了浮点数运算中对符号的处理，确保指数可以轻松表示负值。

### 4. 示例：浮点数指数的偏移与计算
假设我们有一个float型浮点数，其二进制表示的指数部分为`10000010`（即130），可以计算出：
$$
\text{实际指数} = 130 - 127 = 3
$$
这表示浮点数的实际指数是 `2^3`。

**对比补码**：
若指数部分使用补码来表示负指数，处理方式会更加复杂，因为补码需要通过位操作转换，而偏移量则简单、直接，适合浮点数运算。

### 5. 偏移量的意义
偏移量的使用有以下好处：
- **简化指数的存储和表示**：通过偏移，指数可以用无符号整数来表示，不必处理负数的符号位。
- **提高计算效率**：偏移比补码更适合指数，因为补码运算涉及更多的位操作，而偏移是固定的加法或减法。

### 总结
- **偏移**是一种在浮点数中表示指数正负的方式，用固定的偏移量将正负指数映射为无符号整数。
- **补码**则是一种用于整数的负数表示法，两者都实现了负数的表示，但使用场景不同。
- 在浮点数中，偏移比补码更合适，因为偏移设计更符合指数计算需求，且简化了浮点数的操作。